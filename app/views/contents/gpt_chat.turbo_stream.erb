<%= turbo_stream.remove('content-heading') %>
<%= turbo_stream.replace('chat-results') do %>
  <%= panel_item(id: 'post-results') do %>
    <% if @results.dig("choices").length > 1 %>
      <ul class="nav nav-tabs" id="optionsTabs" role="tablist">
        <% @results.dig("choices").length.times do | index | %>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link <%= 'active' if index == 0 %>"
              id="option-<%= index %>"
              data-bs-toggle="tab"
              data-bs-target="#option-<%= index %>-pane"
              type="button"
              role="tab"
              aria-controls="option-<%= index %>-pane"
              aria-selected="true"
            >
              Option <%= index + 1 %>
            </button>
          </li>
        <% end %>
      </ul>
    <% end %>
    <%= card(classes: 'text-start') do %>
      <% begin %>
        <% if @results.dig("choices").length == 1 %>
          <div>
            <%= @results.dig("choices", 0, "message", "content").html_safe %>
          </div>
        <% end %>
        <% if @results.dig("choices").length > 1 %>
          <div class="tab-content" id="optionsTabsContent">
            <% @results.dig("choices").length.times do | index | %>
              <div
                class="tab-pane fade <%= 'show active' if index == 0 %>"
                id="option-<%= index %>-pane"
                role="tabpanel"
                aria-labelledby="option-<%= index %>"
                tabindex="0"
              >
                <%= @results.dig("choices", index, "message", "content").html_safe %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% rescue => e %>
        <h2 class="mt-3">Awesome-o could not compute... Please try again.</h2>
      <% end %>
    <% end %>
  <% end %>
<% end %>
