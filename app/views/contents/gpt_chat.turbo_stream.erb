<%# Remove header %>
<%= turbo_stream.remove('content-heading') %>

<%# Add results from response %>
<%= turbo_stream.replace('chat-results') do %>
  <%= panel_item(id: 'post-results') do %>
    <ul class="nav nav-tabs" id="optionsTabs" role="tablist">
      <% if @results.dig("choices").length > 1 %>
        <% @results.dig("choices").length.times do | index | %>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link <%= 'active' if index == 0 %>"
              id="option-<%= index %>"
              data-bs-toggle="tab"
              data-bs-target="#option-<%= index %>-pane"
              type="button"
              role="tab"
              aria-controls="option-<%= index %>-pane"
              aria-selected="true"
            >
              Option <%= index + 1 %>
            </button>
          </li>
        <% end %>
      <% end %>
    </ul>
    <%= card(classes: 'text-start') do %>
      <%= form_with(url: root_path) do |form| %>
      <% begin %>
        <% if @results.dig("choices").length == 1 %>
          <div>
            <%= form.rich_text_area(:body,
              value: @results.dig("choices", 0, "message", "content"),
              class: 'form-control'
            ) %>
          </div>
        <% end %>
        <% if @results.dig("choices").length > 1 %>
          <div class="tab-content" id="optionsTabsContent">
            <% @results.dig("choices").length.times do | index | %>
              <div
                class="tab-pane fade <%= 'show active' if index == 0 %>"
                id="option-<%= index %>-pane"
                role="tabpanel"
                aria-labelledby="option-<%= index %>"
                tabindex="0"
              >
                <%= form.rich_text_area(:body,
                  value: @results.dig("choices", index, "message", "content"),
                  class: 'form-control border'
                ) %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% rescue => e %>
        <h2 class="mt-3">Awesome-o could not compute... Please try again.</h2>
      <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<%# Add results actions %>
<%= form_with(url: '/none') do |form| %>
  <%= turbo_stream.replace('results-actions') do %>
    <div class="wall__footer border-top">
      <%= form.submit('Save post', class: 'btn btn-primary text-white') %>
    </div>
  <% end %>
<% end %>
