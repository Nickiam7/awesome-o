<%# Remove header %>
<%= turbo_stream.remove('content-heading') %>

<%# Add results from response %>
<%= turbo_stream.replace('chat-results') do %>
  <%= panel_item(id: 'post-results') do %>
    <ul class="nav nav-tabs" id="optionsTabs" role="tablist">
      <% if @results.dig("choices").length > 1 %>
        <% @results.dig("choices").length.times do | index | %>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link <%= 'active' if index == 0 %>"
              id="option-<%= index %>"
              data-bs-toggle="tab"
              data-bs-target="#option-<%= index %>-pane"
              type="button"
              role="tab"
              aria-controls="option-<%= index %>-pane"
              aria-selected="true"
            >
              Option <%= index + 1 %>
            </button>
          </li>
        <% end %>
      <% end %>
      <%= link_to(edit_message_contents_path, class: 'btn btn-light ms-auto') do %>
        <i class="bi bi-pencil-square"></i> Edit
      <% end %>
    </ul>
    <%= card(classes: 'text-start') do %>
      <%= form_with(url: root_path) do |form| %>
      <% begin %>
        <% if @results.dig("choices").length == 1 %>
          <div>
            <%= @results.dig("choices", 0, "message", "content").html_safe %>
          </div>
        <% end %>
        <% if @results.dig("choices").length > 1 %>
          <div class="tab-content" id="optionsTabsContent">
            <% @results.dig("choices").length.times do | index | %>
              <div
                class="tab-pane fade <%= 'show active' if index == 0 %>"
                id="option-<%= index %>-pane"
                role="tabpanel"
                aria-labelledby="option-<%= index %>"
                tabindex="0"
              >
                <%= turbo_frame_tag("option-#{index}") do %>
                  <%= @results.dig("choices", index, "message", "content").html_safe %>
                <% end %>
              </div>
            <% end %>
          </div>
        <% end %>
      <% rescue => e %>
        <h2 class="mt-3">Awesome-o could not compute... Please try again.</h2>
      <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<%# Add results actions %>
<%= turbo_stream.replace('results-actions') do %>
  <div class="wall__footer border-top">
    <a href="#" class="btn btn-primary text-white">Test</a>
  </div>
<% end %>
